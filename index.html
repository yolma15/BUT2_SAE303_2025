<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <title>Réchauffement Climatique - Datavisualisation</title>
    <link rel="stylesheet" href="public/css/styles.css" />
  </head>
  <body>
    <main>
      <h1 class="titre"><strong>Évolution de la température moyenne terrestre de 1880 à 2024</strong></h1>

      <div class="datavis-cont" id="datavis">
        <section class="datavis-info">
          <h3>L'évolution de la température</h3>
          <p>
            Pour représenter cette évolution, nous avons utilisé une série
            d'alumettes. Chaque allumette photographiée correspond à une année
            et illustre l’augmentation progressive de la température moyenne sur
            Terre. Au début, les allumettes sont peu brûlées, presque intactes,
            et deviennent progressivement plus consumées au fil des années.
            Cette progression montre l’augmentation continue de la température. 
          </p>
          <h3>Une estimation, sensibilisation</h3>
          <p>
            L’estimation pour l’année 2100 est représentée par une allumette
            noire, symbolisant un futur potentiellement critique si aucune
            mesure n’est prise pour limiter le réchauffement climatique. À
            travers cette métaphore visuelle, les allumettes évoquent à la fois
            la chaleur et la destruction. Nous avons donc voulu sensibiliser le
            spectateur à la réalité du changement climatique et à l’importance
            d’agir pour limiter les conséquences.
          </p>
        </section>
        <section class="datavis-rendu">
          <img
            src="public/img/datavis.png"
            alt="Graphique détaillé de l'évolution de la température moyennes terrestres de 1880 à 2024"
            id="datavis-img"
          />
        </section>
      </div>
      <div class="top-data" id="infos">
        <div class="first-infos-holder">
          <div class="first-left-side">
            <h1>Sujet</h1>
            <p>
              Bienvenue sur notre site dédié à l’analyse et à la visualisation
              de données autour des enjeux environnementaux. Nous souhaitons
              sensibiliser aux risques planétaires, qui représentent des menaces
              pesant sur l’équilibre de la Terre. Certains de ces risques ont
              déjà dépassé des seuils critiques, entraînant des conséquences
              importantes sur l’environnement et les sociétés humaines.
              <br /><br />
              Parmi eux, le réchauffement climatique constitue un enjeu majeur,
              marqué par l’augmentation des températures, la fonte des glaciers
              et la multiplication des événements climatiques extrêmes. Nous
              avons créé un visuel afin de représenter de manière claire
              l’évolution de la température moyenne.
            </p>
          </div>
          <div class="first-right-side">
            <div class="first-right-side-top">
              <img
                src="public/img/sol.jpeg"
                alt="Image de déforestation et impact climatique"
              />
              <img
                src="public/img/Iceberg.jpeg"
                alt="Image de glace polaire et changement climatique"
              />
            </div>
            <div class="first-right-side-bottom">
              <img
                src="public/img/Usine.jpg"
                alt="Image de tempête climatique"
              />
              <img
                src="public/img/feu.jpg"
                alt="Image de désert et sécheresse"
              />
            </div>
          </div>
        </div>

        <div class="second-infos-holder">
          <div class="second-right-side">
            <h2><strong>Réchauffement Climatique</strong> (2025)</h2>

            <div class="main-info-cont">
              <div class="first-column">
                <h2>34%</h2>
                <p>
                  De taux d'émissions de gaz à effet de serre dans le domaine du
                  transport.
                </p>
              </div>
              <div class="second-column">
                <h2>+1.5°C</h2>
                <p>
                  L'augmentation moyenne de la température par rapport à l'ère
                  préindustrielle (1850).
                </p>
              </div>
              <div class="third-column">
                <h2>3 000</h2>
                <p>
                  Quantité de glaciers qui disparaissent chaque année dans le
                  monde.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      

      <div class="graph-part">
        <h4>Variation de température sur Terre</h4>
        <p>
          Ce visual interactif vous permet d'explorer l'évolution du
          réchauffement climatique au fil des années. En ajustant les
          paramètres, vous pouvez visualiser différentes périodes et formes de
          représentation graphique. Ces interactions facilitent l'exploration
          des données climatiques, des informations précieuses et des éléments
          de comparaison pour une meilleure compréhension des tendances à effet
          de serre.
        </p>

        <div class="graph-cont">
          <div class="modifier">
            <h5>Légende</h5>
            <hr />
            <div class="légende1">
              <div class="rouge"></div>
              <p>2024</p>
            </div>
            <div class="légende1">
              <div
                class="hachure-legende"
                style="
                  background: repeating-linear-gradient(
                    45deg,
                    #666,
                    #666 2px,
                    #fff 2px,
                    #fff 4px
                  );
                  border: 1px solid #ddd;
                "
              ></div>
              <p>Prévisionnel</p>
            </div>

            <br>
            <br>
            <h5>Interactions</h5>
            <hr />

            <div
              style="
                margin-bottom: 15px;
                display: flex;
                gap: 10px;
                align-items: center;
              "
            >
              <input
                type="checkbox"
                id="filter-years"
                name="filter-years"
                style="width: auto"
              />
              <label for="filter-years" style="margin: 0; color: white"
                >Années clés seulement</label
              >
            </div>

            <label for="choix-couleur">Couleur du graphique</label>
            <select id="choix-couleur" aria-label="Choisir la couleur globale">
              <option value="rouge" selected>Rouge</option>
              <option value="orange">Orange</option>
              <option value="jaune">Jaune</option>
            </select>

            <label for="forme-graphique">Forme de représentation</label>
            <select
              id="forme-graphique"
              aria-label="Choisir la forme de représentation du graphique"
            >
              <option value="bar" selected>En barre</option>
              <option value="line">À points reliés</option>
              <option value="scatter">À points</option>
            </select>

            <button
              type="button"
              id="btn-valider"
              aria-label="Valider les modifications"
            >
              Valider
            </button>
          </div>

          <div class="graph">
            <canvas
              id="chart"
              role="img"
              aria-label="Graphique : Variation de température moyenne mondiale de 1880 à 2100"
            ></canvas>
            <canvas
              id="chart1"
              role="img"
              aria-label="Graphique : Émissions territoriales de CO2 par habitant en 1990 et 2022"
            ></canvas>
            <canvas
              id="chart2"
              role="img"
              aria-label="Graphique : Comparaison des émissions de CO2 entre 1990 et 2022"
            ></canvas>
          </div>
        </div>
      </div>
    </main>


    <div id="lightbox" class="lightbox">
      <span class="lightbox-close">&times;</span>
      <img class="lightbox-img" src="" alt="Datavis agrandie" />
    </div>
    <script>
      // --- 1. DONNÉES ---
      const allLabels = [
        "1880",
        "1960",
        "1980",
        "1990",
        "2000",
        "2010",
        "2020",
        "2024",
        "2062",
        "2100",
      ];
      const allData = [0, 0.1, 0.4, 0.6, 0.8, 1, 1.2, 1.4, 2.8, 4];

      // Identification des indices spéciaux
      const index2024 = 7; // Index de l'année 2024
      const forecastIndices = [8, 9]; // Indices pour 2062 et 2100

      // Données filtrées (Années clés : 1880, 1960, 2024, 2100)
      // On doit recalculer les indices correspondants pour le mode filtré
      const keyIndices = [0, 1, 7, 9];
      const keyLabels = keyIndices.map((i) => allLabels[i]);
      const keyData = keyIndices.map((i) => allData[i]);

      // Configuration des couleurs
      const colorThemes = {
        rouge: {
          bg: "rgba(255, 107, 107, 0.6)",
          border: "#FF6B6B",
          line: "#FF6B6B",
        },
        orange: {
          bg: "rgba(255, 165, 0, 0.6)",
          border: "#e69500",
          line: "#e69500",
        },
        jaune: {
          bg: "rgba(255, 230, 128, 0.8)",
          border: "#d4b106",
          line: "#d4b106",
        },
      };

      const ctx = document.getElementById("chart");

      // Fonction pour créer un motif hachuré coloré
      function createColoredHatchPattern(colorStr) {
        const patternCanvas = document.createElement("canvas");
        const pCtx = patternCanvas.getContext("2d");
        patternCanvas.width = 10;
        patternCanvas.height = 10;

        // Fond blanc (ou transparent)
        pCtx.fillStyle = "#fff";
        pCtx.fillRect(0, 0, 10, 10);

        // Lignes de la couleur choisie
        pCtx.strokeStyle = colorStr;
        pCtx.lineWidth = 3;
        pCtx.beginPath();
        pCtx.moveTo(0, 10);
        pCtx.lineTo(10, 0);
        pCtx.stroke();

        return ctx.getContext("2d").createPattern(patternCanvas, "repeat");
      }

      // --- 2. CONFIGURATION INITIALE ---
      const chartConfig = {
        type: "bar",
        data: {
          labels: allLabels,
          datasets: [
            {
              label: "Température en °C",
              data: allData,
              borderWidth: 2,
              fill: true,
              tension: 0.4,
              pointRadius: 6,
              pointHoverRadius: 8,
              pointBackgroundColor: "#fff",
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { labels: { color: "#1a1a1a" } },
            title: {
              display: true,
              text: "Variation de la température moyenne terrestre",
              font: { size: 14, weight: "bold" },
              color: "#1a1a1a",
            },
            tooltip: {
              callbacks: {
                label: function (context) {
                  let label = `Température : +${context.raw}°C`;
                  // Ajouter une note si c'est une prévision
                  const year = context.label;
                  if (year === "2062" || year === "2100") {
                    label += " (Prévision)";
                  }
                  return label;
                },
              },
            },
          },
          onClick: (e, elements) => {
            if (elements.length > 0) {
              const index = elements[0].index;
              const currentLabel = myChart.data.labels[index];
              const currentVal = myChart.data.datasets[0].data[index];
              alert(`Année : ${currentLabel}\nTempérature : +${currentVal}°C`);
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: "Température (°C)" },
            },
          },
        },
      };

      let myChart = new Chart(ctx, chartConfig);

      // Fonction principale de mise à jour du style
      function updateChartStyle() {
        // 1. Récupérer les choix
        const colorName = document.getElementById("choix-couleur").value;
        const theme = colorThemes[colorName];
        const isFiltered = document.getElementById("filter-years").checked;
        const formType = document.getElementById("forme-graphique").value;

        // 2. Préparer les données (Filtrées ou Complètes)
        let currentLabels, currentData;
        if (isFiltered) {
          currentLabels = keyLabels;
          currentData = keyData;
        } else {
          currentLabels = allLabels;
          currentData = allData;
        }

        // 3. Générer les tableaux de style (Couleurs et Bordures) pour CHAQUE barre
        // Cela permet de personnaliser barre par barre (2024 gras, Futures hachurées)

        const bgColors = [];
        const borderColors = [];
        const borderWidths = [];

        currentLabels.forEach((label) => {
          const year = parseInt(label);

          // A. Gestion de la Couleur de fond (Hachures pour > 2024)
          if (year > 2024) {
            // Créer un motif hachuré avec la couleur sélectionnée (la couleur de ligne/bordure)
            bgColors.push(createColoredHatchPattern(theme.line));
          } else {
            bgColors.push(theme.bg);
          }

          // B. Gestion des Bordures (2024 en Gras)
          borderColors.push(theme.border);

          if (year === 2024) {
            borderWidths.push(5); // Très épais pour 2024
            bgColors[bgColors.length - 1] = theme.line; // Plein pour 2024
          } else {
            borderWidths.push(2); // Normal
          }
        });

        // 4. Appliquer les modifications au graphique

        // Gestion Type Scatter/Line
        let newType = formType;
        let showLine = true;
        if (formType === "scatter") {
          newType = "line";
          showLine = false;
        }

        myChart.config.type = newType;
        myChart.data.labels = currentLabels;
        myChart.data.datasets[0].data = currentData;
        myChart.data.datasets[0].showLine = showLine;
        myChart.data.datasets[0].fill = newType === "line" && showLine;

        // Application des couleurs calculées
        // Note: Si c'est une ligne (line), on utilise une seule couleur globale pour la ligne
        // Si c'est des barres, on utilise le tableau pour colorier chaque barre différemment
        if (newType === "bar") {
          myChart.data.datasets[0].backgroundColor = bgColors;
          myChart.data.datasets[0].borderColor = borderColors;
          myChart.data.datasets[0].borderWidth = borderWidths;
          myChart.data.datasets[0].pointBackgroundColor = borderColors; // Points suivent la couleur
        } else {
          // Pour les lignes, on garde une couleur unie sinon la ligne change de couleur par segment (moins joli ici)
          myChart.data.datasets[0].backgroundColor = theme.bg;
          myChart.data.datasets[0].borderColor = theme.border;
          myChart.data.datasets[0].borderWidth = 3;
          // Pour le point 2024 sur la ligne, on peut l'agrandir
          const pointRadiuses = currentLabels.map((l) =>
            l === "2024" ? 10 : 5,
          );
          myChart.data.datasets[0].pointRadius = pointRadiuses;
        }

        myChart.update();
      }

      // --- 3. ÉVÉNEMENTS ---
      const btnValider = document.getElementById("btn-valider");

      // Initialisation au chargement
      window.addEventListener("load", updateChartStyle);

      // Clic sur Valider
      btnValider.addEventListener("click", updateChartStyle);



      // ===== LIGHTBOX DATAVIS =====
      const datavisImg = document.getElementById("datavis-img");
      const lightbox = document.getElementById("lightbox");
      const lightboxImg = document.querySelector(".lightbox-img");
      const lightboxClose = document.querySelector(".lightbox-close");

      // Ouvrir la lightbox
      datavisImg.addEventListener("click", () => {
        lightbox.style.display = "flex";
        lightboxImg.src = datavisImg.src;
      });

      // Fermer avec la croix
      lightboxClose.addEventListener("click", () => {
        lightbox.style.display = "none";
      });

      // Fermer en cliquant sur le fond
      lightbox.addEventListener("click", (e) => {
        if (e.target === lightbox) {
          lightbox.style.display = "none";
        }
      });
    </script>



    
  </body>
</html>
